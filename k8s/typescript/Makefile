dev:
	npm run dev

build:
	npm run build && ls -la dist/

run:
	npm run build && npm start

# Dockeré–¢é€£ã®ã‚³ãƒãƒ³ãƒ‰
.PHONY: docker-build docker-run docker-stop docker-clean docker-logs docker-shell

# Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
docker-build:
	docker build -t guestbook-app .

# Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
docker-run:
	@echo "ğŸ” æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¢ºèªä¸­..."
	@docker stop guestbook-container 2>/dev/null || true
	@docker rm guestbook-container 2>/dev/null || true
	@echo "ğŸš€ æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ä¸­..."
	docker run -d \
		-p 3001:3001 \
		-e DATABASE_URL="postgresql://dbmasteruser:dbmaster@ls-644e915cc7a6ba69ccf824a69cef04d45c847ed5.cps8g04q216q.ap-northeast-1.rds.amazonaws.com:5432/dbmaster" \
		--name guestbook-container \
		guestbook-app
	@echo "âœ… ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¾ã—ãŸ"

# Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
docker-stop:
	docker stop guestbook-container

# Dockerã‚³ãƒ³ãƒ†ãƒŠã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤
docker-clean:
	docker stop guestbook-container || true
	docker rm guestbook-container || true
	docker rmi guestbook-app || true

# Dockerã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã‚’è¡¨ç¤º
docker-logs:
	docker logs -f guestbook-container

# Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã‚·ã‚§ãƒ«ã«æ¥ç¶š
docker-shell:
	docker exec -it guestbook-container /bin/sh

# å…¨ã¦ã®Dockerãƒ—ãƒ­ã‚»ã‚¹ã‚’ä¸€æ‹¬ã§å®Ÿè¡Œï¼ˆãƒ“ãƒ«ãƒ‰ï¼†èµ·å‹•ï¼‰
docker-all: docker-build docker-run
	@echo "Docker container is running on http://localhost:3001"
